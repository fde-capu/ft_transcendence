<app-menu-bar></app-menu-bar>
<app-invitation-screen></app-invitation-screen>

<h1>{{ profileType }}<span *ngIf='!amIBlocked'> Profile</span></h1>

<div *ngIf='!amIBlocked; else spying' class='box'>
	<div *ngIf="displayUser; else user_unknown">

		<div class='opt-box' *ngIf="owner">
			<div class='options'>
				<label class='left'>
			change name
				</label>
				<textarea id="name" [(ngModel)]="displayUser.name" class='middle hover_invert'
					(focus)="fun.switchIf('nameButton', 'Change', 'Ok'); saveLastName(); setEditing();"
					(focusout)="fun.switchIf('nameButton', 'Ok', 'Change'); validateAndSaveUser();"
					(keydown.enter)="fun.blur('name'); fun.blink('nameButton');"
				></textarea>
				<div *ngIf='invalidNameNotice' id='invalidNameNotice'><- <b>Invalid</b>&nbsp;
				</div>
				<button *ngIf='!invalidNameNotice' id="nameButton" type="button" class='right' (click)=
					"fun.focusIf('nameButton', 'Change', 'name');"
					>Change
				</button>
			</div>

			<div class='options'>
				<label class='left'>
			change image
				</label>
				<div class="small-profile-image hover_invert"
					style="background-image:url('{{ displayUser.image }}'); background-size: cover; overflow: hidden;">
				</div>
        <input #file type="file" name="file" accept="image/*">
				<button type="button" (click)="upload(file)">Change Image</button>
        <span *ngIf="imageError">{{ imageError }}</span>
			</div>

			<div class='options'>
				<label>
			2FA
				</label>
					<div *ngIf="displayUser.mfa_enabled">
						<div class='centered'>
							ACTIVE
						</div>
						<br>
						<div>
							<button (click)="switchMfa();">Deactivate</button>
						</div>
					</div>
					<div *ngIf="!displayUser.mfa_enabled">
						<div class='centered'>
							OFF
						</div>
						<br>
						<div>
							<button (click)="switchMfa();">Activate</button>
						</div>
					</div>
				<app-login class='overall' *ngIf='mfaOpened' [stepActivate]='true'>
				</app-login>
			</div>
		</div>

		<div class='oneliner'>
			<div class="profile-image hover_invert"
				style="background-image:url('{{ displayUser.image }}'); background-size: cover; overflow: hidden;">
			</div>
			<div class='info'>
				<span class='small-id'>{{displayUser.intraId}}</span>
				<span class='big-user'>{{displayUser.name}}</span>
			</div>
		</div>

		<div class='actions'>
		<app-u2u-actions *ngIf='!owner'
			[isFriend]='isFriend' [isBlock]='isBlock' [amIBlocked]='amIBlocked' [user]='displayUser'
			[caption]='false' [singleline]='true'>
		</app-u2u-actions>
		</div>

		<app-friends-list [user]="displayUser"></app-friends-list>
		<app-blocks-list *ngIf="owner" [user]="displayUser"></app-blocks-list>
		<app-statistics [user]="displayUser"></app-statistics>
		<app-history [user]="displayUser"></app-history>
	</div>
</div>

<ng-template #user_unknown>
User: unknown.
</ng-template>

<ng-template #spying>
  <div *ngIf="displayUser" class='info box'>
    <div
      class="profile-image hover_invert"
      style="background-image: url('{{ displayUser.image }};'); background-size: cover; overflow: hidden;">
	</div>
		<div>
    {{ displayUser.intraId }}
		</div>
    <app-u2u-actions
      *ngIf="!owner"
      [isFriend]="isFriend"
      [isBlock]="isBlock"
      [amIBlocked]="amIBlocked"
      [user]="displayUser"
      [caption]="false"
      [singleline]="true">
	</app-u2u-actions>
  </div>
</ng-template>
